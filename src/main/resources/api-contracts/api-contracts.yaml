openapi: 3.0.0
info:
  title: Global API Gateway
  version: 1.0.0

servers:
  - url: http://localhost:8080
    description: Local Development API Gateway
  - url: https://api.krazytop.com
    description: Production API Gateway

tags:
  - name: Destiny Authentification
    description: Operations related to Destiny 2 authentication.
  - name: League of Legends Metadata
    description: Operations related to League of Legends metadata.
  - name: League of Legends Patch
    description: Operations related to League of Legends patches.
  - name: Teamfight Tactics Metadata
    description: Operations related to Teamfight Tactics metadata.
  - name: Teamfight Tactics Patch
    description: Operations related to Teamfight Tactics patches.

paths:
  /language:
    $ref: './controllers/language.yaml#/getAllSupportedLanguages'
  /destiny/auth/{code}:
    $ref: './controllers/destiny/destiny-auth.yaml#/getPlayerTokens'
  /destiny/auth:
    $ref: './controllers/destiny/destiny-auth.yaml#/updatePlayerTokens'
  /lol/metadata:
    $ref: './controllers/lol/lol-metadata.yaml#/getMetadata'
  /tft/metadata:
    $ref: './controllers/tft/tft-metadata.yaml#/getMetadata'
  /lol/patch:
    $ref: './controllers/lol/lol-patch.yaml#/updateAllPatches'
  /tft/patch:
    $ref: './controllers/tft/tft-patch.yaml#/updateAllPatches'
  /lol/patch/{patchId}/{language}:
    $ref: './controllers/lol/lol-patch.yaml#/getPatch'
  /tft/patch/{patchId}/{language}:
    $ref: './controllers/tft/tft-patch.yaml#/getPatch'

components:
  schemas:
    ApiError:
      type: object
      description: |
        Represents a standardized error response returned by the API when a request
        cannot be processed successfully. It provides a machine-readable code,
        a human-readable message, and optional detailed information for specific issues.
      required:
        - code
        - message
      properties:
        code:
          type: string
          description: A unique, application-specific error code.
          example: "INVALID_INPUT"
        message:
          type: string
          description: A human-readable error message that provides a brief explanation of the error.
          example: "The provided 'date' parameter has an invalid format."
        details:
          type: array
          items:
            type: object
            properties:
              field:
                type: string
                description: The name of the field that caused the error.
                example: "date"
              issue:
                type: string
                description: A specific issue with the field.
                example: "must respect the format"
          description: A list of specific validation errors.
    LanguageDTO:
      type: object
      description: Entity representing a language and its associated game patch paths.
      required:
        - name
        - riotPatchPath
        - destinyPatchPath
      properties:
        name:
          type: string
          description: The name of the language.
          example: "Fran√ßais"
        riotPatchPath:
          type: string
          description: The RIOT patch path.
          example: "fr_FR"
        destinyPatchPath:
          type: string
          description: The Destiny patch path.
          example: "fr_FR"
    DestinyAuthTokensDTO:
      type: object
      description: |
        Represents Bungie authentification tokens containing access and refresh tokens,
        along with expiration information and the membership ID.
      required:
        - access_token
        - token_type
        - expires_in
        - refresh_token
        - refresh_expires_in
        - membership_id
      properties:
        access_token:
          type: string
          description: The access token used to authenticate future API requests.
          example: "CKy1BxKGAgAgHxlqkdJcDjAJ3Dkh4ILp3ddvxxqnBpj+YJDm++dhWNDgAAAAqJgWwVRarfCcmdKvQUi6A9tHfETM3NjLhQuWou6+YdLaUFq8Jp3cibIj+xUNqc8k3i3RsU0E6hJmYrblrZ6Z6DcUmFW9SgpIaIxuB4BU15VJUmnmDNxXRntelyctsC++fY0HLdICV+9aEK7VmQHCO0j3TYrRMf2aof7lS59ct821K48DEVg8KdLEOMvOPoX6ohW/TV7wbJLXpSnhrzS2TnanzMIyycJJHqTu1zcGaJ5iOnEL6oIRKN0bJRl23tJdgXH+dJlIOKoB+1QcGAxZdqkjGdI8TGYAf9pBVl0aJsM="
        token_type:
          type: string
          description: The type of token, typically "Bearer".
          example: "Bearer"
        expires_in:
          type: integer
          format: int32
          description: The validity duration of the access token in seconds.
          example: 3600
        refresh_token:
          type: string
          description: The refresh token used to obtain a new access token.
          example: "CKy1BxKGAgAgf5vy8riRnThQj+l79abfpE/2rIL/CAMy4DSJXdZ3fH7gAAAAEGCNeHJQIOOGTwDDzQfOVybHsiVJhJoLgCfsUdH6PslsiNNfN+Ba2aG2b8ibOqYOvFKm0BqAUx6PQhusbgjOIeCs+rPViOJ5HQfId/aFaJ1GpSMrV9tw7xAGVPFZzVZ/xjv3mF4f+thMq9MQD6VuxqCa8BBXvplWlDX/CluYEinqZlXpDABgAanj2O5nkuu1AubLy3f0Jdt8mjr8ikPmA2DAE44mnhtSLcJF49rAa7/z0VYDRK94nMjjLrI8t+cOeCJNUpSrexbx4CQXUo5TaOmtQquIpl/APwYqh44Bnh4="
        refresh_expires_in:
          type: integer
          format: int32
          description: The validity duration of the refresh token in seconds.
          example: 7776000
        membership_id:
          type: string
          description: The unique Bungie membership ID associated with these tokens.
          example: "14865130"
    RIOTMetadataDTO:
      type: object
      description: Entity representing current game season, patch, and historical patch information for RIOT games.
      required:
        - currentSeasonOrSet
        - currentPatch
        - allPatches
      properties:
        currentSeasonOrSet:
          type: integer
          format: int32
          description: The current League of Legends season number or Teamfight Tactics set number.
          example: 15
        currentPatch:
          type: string
          description: The current RIOT game patch version.
          example: "15.12"
        allPatches:
          type: array
          description: A list of all available RIOT games patch versions.
          items:
            type: string
          example:
            - "14.24"
            - "14.23"
            - "14.22"
    LOLAvailableRanks:
      description: Enum representing all available ranks in League of Legends.
      type: string
      enum:
        - "RANKED_SOLO_5x5"
        - "RANKED_TEAM_5x5"
    TFTAvailableRanks:
      description: Enum representing all available ranks in Teamfight Tactics.
      type: string
      enum:
        - "RANKED_TFT"
        - "RANKED_TFT_TURBO"
        - "RANKED_TFT_DOUBLE_UP"
    TFTPatchDTO:
      type: object
      description: Represents the nomenclature and data for a specific Teamfight Tactics patch.
      required:
        - id
        - patchId
        - language
        - set
        - units
        - traits
        - items
        - augments
        - queues
      properties:
        id:
          type: string
          description: Unique identifier for the patch nomenclature, a concatenation of patchId and language.
          example: "14.12_en_US"
        patchId:
          type: string
          description: The ID of the TFT patch.
          example: "14.12"
        language:
          type: string
          description: The language of the nomenclature.
          example: "en_US"
        set:
          type: integer
          format: int32
          description: The TFT set number associated with this patch.
          example: 11
        units:
          type: array
          description: List of Teamfight Tactics units and their nomenclature for this patch.
          items:
            $ref: '#/components/schemas/TFTUnitNomenclatureDTO'
        traits:
          type: array
          description: List of Teamfight Tactics traits and their nomenclature for this patch.
          items:
            $ref: '#/components/schemas/TFTTraitNomenclatureDTO'
        items:
          type: array
          description: List of Teamfight Tactics items and their nomenclature for this patch.
          items:
            $ref: '#/components/schemas/TFTItemNomenclatureDTO'
        augments:
          type: array
          description: List of Teamfight Tactics augments and their nomenclature for this patch.
          items:
            $ref: '#/components/schemas/TFTItemNomenclatureDTO'
        queues:
          type: array
          description: List of Riot game queues and their nomenclature for this patch.
          items:
            $ref: '#/components/schemas/RIOTQueueNomenclatureDTO'
    TFTUnitNomenclatureDTO:
      type: object
      description: Represents a Teamfight Tactics (TFT) unit with its nomenclature and details.
      properties:
        id:
          type: string
          description: The unique API name/identifier for the TFT unit.
          example: "TFT11_Ahri"
        name:
          type: string
          description: The display name of the TFT unit.
          example: "Ahri"
        image:
          type: string
          description: URL or path to the icon representing the unit's tile image.
          example: "https://raw.communitydragon.org/latest/game/assets/characters/tft11_ahri/tft11_ahri_tile.png"
        cost:
          type: integer
          format: int32
          description: The in-game gold cost of the unit.
          example: 2
        traits:
          type: array
          description: List of trait IDs associated with the unit.
          items:
            type: string
          example: [ "Porcelain", "Invoker", "Sage" ]
        ability:
          $ref: '#/components/schemas/TFTAbilityEntityDTO'
    TFTAbilityEntityDTO:
      type: object
      description: Represents the details of a TFT unit's ability.
      properties:
        name:
          type: string
          description: The name of the ability.
          example: "Essence Theft"
        image:
          type: string
          description: URL or path to the icon representing the ability.
          example: "https://raw.communitydragon.org/latest/game/assets/characters/tft11_ahri/tft11_ahri_ability_icon.png"
        description:
          type: string
          description: A detailed description of the ability's effects.
          example: "Ahri launches a orb that deals magic damage to enemies."
        variables:
          type: array
          description: List of dynamic variables used in the ability's description or scaling.
          items:
            $ref: '#/components/schemas/TFTVariableEntityDTO'
          example:
            - name: "Damage"
              value: [ 100.0, 150.0, 200.0 ]
            - name: "ManaCost"
              value: [ 40.0, 80.0, 120.0 ]
    TFTVariableEntityDTO:
      type: object
      description: Represents a variable used in a TFT ability's scaling or description.
      properties:
        name:
          type: string
          description: The name of the variable.
          example: "Damage"
        value:
          type: array
          description: A list of numerical values for the variable, often corresponding to ability ranks.
          items:
            type: number
            format: double
          example: [ 100.0, 150.0, 200.0 ]
    TFTTraitNomenclatureDTO:
      type: object
      description: Represents a Teamfight Tactics (TFT) trait with its nomenclature and details.
      properties:
        id:
          type: string
          description: The unique API name/identifier for the TFT trait.
          example: "Set11_Porcelain"
        description:
          type: string
          description: A detailed description of the trait's effects.
          example: "Porcelain champions gain Attack Speed and reduce incoming damage."
        name:
          type: string
          description: The display name of the TFT trait.
          example: "Porcelain"
        image:
          type: string
          description: URL or path to the icon representing the trait.
          example: "https://raw.communitydragon.org/latest/game/assets/traits/tft11_trait_porcelain.png"
        effects:
          type: array
          description: List of the trait's effect tiers based on the number of units.
          items:
            $ref: '#/components/schemas/TFTEffectEntityDTO'
          example:
            - maxUnits: 2
              minUnits: 2
              style: 1
              variables:
                ASPercent: 0.1
                DamageReduction: 0.05
            - maxUnits: 4
              minUnits: 4
              style: 2
              variables:
                ASPercent: 0.2
                DamageReduction: 0.1
    TFTEffectEntityDTO:
      type: object
      description: Represents a specific tier or effect level of a TFT trait.
      properties:
        maxUnits:
          type: integer
          format: int32
          description: The maximum number of units required to activate this effect tier.
          example: 2
        minUnits:
          type: integer
          format: int32
          description: The minimum number of units required to activate this effect tier.
          example: 2
        style:
          type: integer
          format: int32
          description: Indicates the visual style or tier level of the effect.
          example: 1
        variables:
          type: object
          description: A map of variable names to their corresponding numerical values for this effect tier.
          additionalProperties:
            type: number
            format: double
          example:
            ASPercent: 0.1
            DamageReduction: 0.05
    TFTItemNomenclatureDTO:
      type: object
      description: Represents a Teamfight Tactics (TFT) item or augment with its nomenclature and details.
      properties:
        id:
          type: string
          description: The unique identifier for the TFT item. This field is read-only and provided by the server.
          example: "TFT_Item_BFSword"
        name:
          type: string
          description: The display name of the TFT item.
          example: "B.F. Sword"
        image:
          type: string
          description: URL or path to the icon image of the item.
          example: "https://raw.communitydragon.org/latest/game/assets/items/tft_item_bfsword.png"
        description:
          type: string
          description: A detailed description of the item's effects or properties.
          example: "+10 Attack Damage. Combine with other items to create stronger ones."
        variables:
          type: object
          description: A map of variable names to their corresponding numerical values, representing various effects.
          additionalProperties:
            type: number
            format: double
          example:
            AD: 10.0
            AP: 0.0
        composition:
          type: array
          description: A list of item IDs that are required to build this item.
          items:
            type: string
          example: [ "TFT_Item_RecurveBow", "TFT_Item_GiantsBelt" ]
    RIOTQueueNomenclatureDTO:
      type: object
      description: Represents a Riot Games queue with its nomenclature.
      required:
        - patchId
        - language
        - season
        - champions
        - items
        - summonerSpells
        - augments
        - runes
        - queues
      properties:
        id:
          type: string
          description: The unique identifier for the queue.
          example: "RANKED_SOLO_5x5"
        name:
          type: string
          description: The display name of the queue.
          example: "Ranked Solo/Duo"
        description:
          type: string
          description: A brief description of the queue.
          example: "A competitive queue where players are matched individually or in pairs."
    LOLPatchDTO:
      type: object
      description: Represents a specific League of Legends game patch with its associated data.
      properties:
        id:
          type: string
          description: Unique identifier for the LoL patch, typically a concatenation of patchId and language.
          example: "14.12_en_US"
        patchId:
          type: string
          description: The ID of the LoL patch.
          example: "14.12"
        language:
          type: string
          description: The language of the nomenclature for this patch.
          example: "en_US"
        season:
          type: integer
          format: int32
          description: The League of Legends season number associated with this patch.
          example: 15
        champions:
          type: array
          description: List of League of Legends champions and their nomenclature for this patch.
          items:
            $ref: '#/components/schemas/LOLChampionNomenclatureDTO'
        items:
          type: array
          description: List of League of Legends items and their nomenclature for this patch.
          items:
            $ref: '#/components/schemas/LOLItemNomenclatureDTO'
        summonerSpells:
          type: array
          description: List of League of Legends summoner spells and their nomenclature for this patch.
          items:
            $ref: '#/components/schemas/LOLSummonerSpellNomenclatureDTO'
        augments:
          type: array
          description: List of League of Legends augments and their nomenclature for this patch.
          items:
            $ref: '#/components/schemas/LOLAugmentNomenclatureDTO'
        runes:
          type: array
          description: List of League of Legends runes and their nomenclature for this patch.
          items:
            $ref: '#/components/schemas/LOLRuneNomenclatureDTO'
        queues:
          type: array
          description: List of Riot game queues and their nomenclature relevant to this patch.
          items:
            $ref: '#/components/schemas/RIOTQueueNomenclatureDTO'
    LOLNomenclatureDTO:
      type: object
      description: Base nomenclature for League of Legends entities.
      properties:
        id:
          type: string
          description: The unique identifier for the entity.
          example: "Aatrox"
        name:
          type: string
          description: The display name of the entity.
          example: "Aatrox"
        image:
          type: string
          description: URL or path to the image of the entity.
          example: "https://example.com/aatrox.png"
        description:
          type: string
          description: A brief description of the entity.
          example: "The Darkin Blade"
    LOLChampionNomenclatureDTO:
      type: object
      description: Represents a League of Legends champion with its nomenclature and details.
      allOf:
        - $ref: '#/components/schemas/LOLNomenclatureDTO'
      properties:
        id:
          type: string
          description: The unique identifier for the champion.
          example: "Aatrox"
        title:
          type: string
          description: The champion's title.
          example: "the Darkin Blade"
        stats:
          type: object
          description: A map of champion stats to their numerical values.
          additionalProperties:
            type: integer
            format: int32
          example:
            hp: 650
            ad: 60
            armor: 38
        tags:
          type: array
          description: A list of tags or roles associated with the champion.
          items:
            type: string
          example: [ "Fighter", "Tank" ]
    LOLItemNomenclatureDTO:
      type: object
      description: Represents a League of Legends item with its nomenclature and detailed properties.
      allOf:
        - $ref: '#/components/schemas/LOLNomenclatureDTO'
      properties:
        plainText:
          type: string
          description: A short description of the item's effects, often without detailed numbers.
          example: "Increases Movement Speed"
        baseGold:
          type: integer
          format: int32
          description: The base gold cost of the item.
          example: 300
        totalGold:
          type: integer
          format: int32
          description: The total gold cost of the item.
          example: 300
        tags:
          type: array
          description: A list of tags or categories associated with the item.
          items:
            type: string
          example: [ "Boots", "Nonconsumable" ]
        stats:
          type: object
          description: A map of item stats to their numerical values (e.g., "FlatMovementSpeedMod", "FlatMagicDamageMod").
          additionalProperties:
            type: number
            format: double
          example:
            FlatMovementSpeedMod: 25.0
            FlatHPPoolMod: 0.0
        toItems:
          type: array
          description: A list of item IDs that this item can build into.
          items:
            type: string
          example: [ "3006", "3009" ]
        fromItems:
          type: array
          description: A list of item IDs that this item is built from.
          items:
            type: string
          example: [ "3006", "3009" ]
    LOLSummonerSpellNomenclatureDTO:
      type: object
      description: Represents a League of Legends summoner spell with its nomenclature and detailed properties.
      allOf:
        - $ref: '#/components/schemas/LOLNomenclatureDTO'
      properties:
        tooltip:
          type: string
          description: The detailed tooltip text of the summoner spell, often including scaling values.
          example: "Teleports your champion to target nearby location. {{ cooldownBurn }} seconds cooldown."
        cooldownBurn:
          type: number
          format: float
          description: The cooldown duration of the summoner spell in seconds.
          example: 300.0
    LOLAugmentNomenclatureDTO:
      type: object
      description: Represents a League of Legends Augment (e.g., from Arena mode or Hextech Augments) with its nomenclature and data values.
      allOf:
        - $ref: '#/components/schemas/LOLNomenclatureDTO'
      properties:
        dataValues:
          type: object
          description: A map of key-value pairs representing various numerical data points associated with the augment.
          additionalProperties:
            type: integer
            format: int32
          example:
            BonusDamagePercent: 10
            HealthThreshold: 500
    LOLRunePerkNomenclatureDTO:
      type: object
      description: Represents a specific League of Legends rune perk.
      allOf:
        - $ref: '#/components/schemas/LOLNomenclatureDTO'
      properties:
        longDescription:
          type: string
          description: The detailed description of the rune perk.
          example: "Gain 1-10 (based on level) adaptive force for 10 seconds after damaging a champion. Stacks up to 5 times. Max stacks: 5-50 (based on level) adaptive force."
    LOLRuneNomenclatureDTO:
      type: object
      description: Represents a League of Legends rune path with its associated perks.
      allOf:
        - $ref: '#/components/schemas/LOLNomenclatureDTO'
      properties:
        perks:
          type: array
          description: Nested list of rune perks, representing the different rows/choices within the rune path.
          items:
            type: array
            items:
              $ref: '#/components/schemas/LOLRunePerkNomenclatureDTO'
          example:
            - id: "Conqueror"#TODO enlever les string ?
              name: "Conqueror"
              image: "https://example.com/conqueror.png"
              description: "Gain Adaptive Force on hit."
              longDescription: "Attacks and spell hits grant 1.2-4.2 Adaptive Force for 5s (max 10 stacks). At max stacks, heal for 8% of damage dealt to champions."
            - id: "PressTheAttack"
              name: "Press the Attack"
              image: "https://example.com/presstheattack.png"
              description: "Hitting a champion 3 times deals bonus damage and makes them vulnerable."
              longDescription: "Hitting an enemy champion 3 consecutive times deals 40-180 bonus Adaptive Damage and makes them vulnerable, increasing the damage they take by 8% from all sources for 6s."